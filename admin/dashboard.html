<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet">
    <style>
        .sidebar {
            height: 100vh;
            background: #2c3e50;
            color: white;
            position: fixed;
            width: 250px;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .nav-link {
            color: white;
            padding: 15px 20px;
        }
        .nav-link:hover {
            background: #34495e;
            color: white;
        }
        .nav-link.active {
            background: #34495e;
        }
        .product-image {
            max-width: 100px;
            max-height: 100px;
        }
    </style>
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="p-3">
                <h4>Admin Panel</h4>
            </div>
            <nav class="nav flex-column">
                <a class="nav-link active" href="#" data-section="products">
                    <i class='bx bx-package'></i> Product Management
                </a>
                <a class="nav-link" href="#" data-section="orders">
                    <i class='bx bx-history'></i> Order History
                </a>
                <a class="nav-link" href="#" data-section="accounts">
                    <i class='bx bx-user'></i> Account Management
                </a>
                <a class="nav-link" href="#" id="logoutBtn">
                    <i class='bx bx-log-out'></i> Logout
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Product Management Section -->
            <div id="products" class="section">
                <h2>Product Management</h2>
                <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addProductModal">
                    Add New Product
                </button>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Assigned Customers</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Order History Section -->
            <div id="orders" class="section" style="display: none;">
                <h2>Order History</h2>
                <div class="mb-3">
                    <input type="text" class="form-control w-25 d-inline-block" id="customerSearch" 
                           placeholder="Search by Customer ID">
                    <button class="btn btn-secondary" onclick="exportOrdersToCSV()">Export CSV</button>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer ID</th>
                                <th>Product Ordered</th>
                                <th>Total Price</th>
                                <th>Order Date</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Account Management Section -->
            <div id="accounts" class="section" style="display: none;">
                <h2>Account Management</h2>
                <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addUserModal">
                    Add New User
                </button>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Customer ID</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="mb-3">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" name="Name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Price</label>
                            <input type="number" class="form-control" name="Price" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Image URL</label>
                            <input type="url" class="form-control" name="ImageURL">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Assigned Customers</label>
                            <select class="form-select" name="AssignedCustomerIDS" multiple>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'pathhm43xpa5TmwaG.3b6a259e92f40f97170ba1680a4db0af5c767076db223aef553ae844cf94e542';
        const BASE_ID = 'appipp8LFUGElp3Di';
        
        // Load Products
        async function loadProducts() {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/Products`, {
                    headers: { 'Authorization': `Bearer ${API_KEY}` }
                });
                const data = await response.json();
                
                const tbody = document.getElementById('productsTableBody');
                tbody.innerHTML = data.records.map(product => `
                    <tr>
                        <td>
                            ${product.fields.ImageURL ? 
                              `<img src="${product.fields.ImageURL}" class="product-image" alt="Product">` : 
                              'No image'}
                        </td>
                        <td>${product.fields.Name || ''}</td>
                        <td>$${product.fields.Price || '0'}</td>
                        <td>${product.fields.AssignedCustomerIDS ? 
                             product.fields.AssignedCustomerIDS.join(', ') : ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" 
                                    onclick="editProduct('${product.id}')">Edit</button>
                            <button class="btn btn-sm btn-danger" 
                                    onclick="deleteProduct('${product.id}')">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Load Orders
        async function loadOrders() {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/Orders`, {
                    headers: { 'Authorization': `Bearer ${API_KEY}` }
                });
                const data = await response.json();
                
                const tbody = document.getElementById('ordersTableBody');
                tbody.innerHTML = data.records.map(order => `
                    <tr>
                        <td>${order.fields['Order ID'] || ''}</td>
                        <td>${order.fields['Customer ID'] || ''}</td>
                        <td>${order.fields['Product Ordered'] || ''}</td>
                        <td>$${order.fields['Total Price'] || '0'}</td>
                        <td>${order.fields['Order Date'] || ''}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // Load Users
        async function loadUsers() {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/Users`, {
                    headers: { 'Authorization': `Bearer ${API_KEY}` }
                });
                const data = await response.json();
                
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = data.records.map(user => `
                    <tr>
                        <td>${user.fields.Username || ''}</td>
                        <td>${user.fields.CustomerID || ''}</td>
                        <td>${user.fields.Role || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" 
                                    onclick="editUser('${user.id}')">Edit</button>
                            <button class="btn btn-sm btn-danger" 
                                    onclick="deleteUser('${user.id}')">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Initial load
        loadProducts();

        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.id === 'logoutBtn') {
                    localStorage.removeItem('user');
                    window.location.href = '../login.html';
                    return;
                }

                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                const section = this.dataset.section;
                document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
                document.getElementById(section).style.display = 'block';

                if (section === 'products') loadProducts();
                if (section === 'orders') loadOrders();
                if (section === 'accounts') loadUsers();
            });
        });
    </script>
</body>
</html> 